(function(e,_){typeof exports=="object"&&typeof module<"u"?module.exports=_(require("vue"),require("d3")):typeof define=="function"&&define.amd?define(["vue","d3"],_):(e=typeof globalThis<"u"?globalThis:e||self,e.GanttLib=_(e.Vue,e.d3))})(this,function(e,_){"use strict";function ae(y){const V=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(y){for(const c in y)if(c!=="default"){const k=Object.getOwnPropertyDescriptor(y,c);Object.defineProperty(V,c,k.get?k:{enumerable:!0,get:()=>y[c]})}}return V.default=y,Object.freeze(V)}const d=ae(_),ne=(y,V)=>{const c=y.__vccOpts||y;for(const[k,l]of V)c[k]=l;return c},le={class:"gantt-wrapper relative w-full"},re={class:"absolute top-0 right-0 z-10 flex space-x-4 items-center mr-2"},oe={class:"flex items-center space-x-2"},se=["value"],ie=["disabled"],de={key:0,class:"absolute inset-0 flex items-center justify-center bg-gray-50/50 z-20"},ue={class:"text-xl font-semibold text-gray-600 p-4 bg-white rounded-lg shadow-lg"},ce={key:1,class:"absolute inset-0 flex items-center justify-center bg-gray-50/50 z-20"},me={class:"text-xs text-gray-500 mt-2"},fe={class:"text-xs font-medium text-gray-600"},ge={class:"text-xs font-medium text-gray-600"},pe=["value"],xe=["title"],ye={class:"text-xs font-medium text-gray-600"},ve={class:"text-xs font-medium text-gray-600"},he={class:"text-xs font-medium text-gray-600"},be={class:"mt-3 flex justify-between items-center"},we={class:"text-xs font-bold text-blue-600"},J=5,De=.2,Ee=ne({__name:"GanttChart",props:{tasks:{type:Array,default:()=>[]},startDate:{type:String,default:"2012-12-12"},endDate:{type:String,default:"2013-12-13"}},emits:["taskUpdated"],setup(y,{emit:V}){const c=V,k=y,l=e.ref([]),M=e.ref("All"),K=["#4F46E5","#10B981","#F59E0B","#EF4444","#6366F1","#EC4899","#06B6D4"],P=e.ref({}),ke=a=>{if(a.length===0)return 1;const t=[...a].sort((o,s)=>o-s),n=Math.floor(t.length/2);return t.length%2===0?(t[n-1]+t[n])/2:t[n]},G=a=>{const t=new Set;a.forEach(s=>{s.category&&s.category.trim()&&t.add(s.category)});let n={...P.value},o=0;t.forEach(s=>{if(!n[s]){let p=K[o%K.length];n[s]=p}o++}),P.value=n},Te=a=>!a||a==="Uncategorized"?"#9CA3AF":P.value[a]||"#9CA3AF",D=e.ref(!1),Ce=e.computed(()=>{const a=new Set;return l.value.forEach(t=>{t.category&&t.category.trim()&&a.add(t.category)}),Array.from(a).sort()}),Ne=e.computed(()=>{const a=new Set(["All"]);return l.value.forEach(t=>{t.category&&t.category.trim()&&a.add(t.category)}),Array.from(a).sort()}),B=e.ref(null),Q=e.ref(0),S={top:40,right:20,bottom:30,left:50},L=e.ref(!1),r=e.ref(null),$=(a,t)=>{if(!a||!t)return 1;const n=new Date(a),s=new Date(t).getTime()-n.getTime();if(s<0)return 1;const p=Math.ceil(s/(1e3*60*60*24))+1;return Math.max(1,p)},Z=a=>$(a.start,a.end),Ve=e.computed(()=>{if(l.value.length===0)return 1;const a=l.value.filter(t=>t.start&&t.end).map(Z);return Math.max(1,ke(a))}),Y=(a,t)=>{if(!a||t<=0)return a;const n=new Date(a);return n.setDate(n.getDate()+t-1),d.timeFormat("%Y-%m-%d")(n)},W=a=>a.toISOString().split("T")[0],g=e.computed(()=>M.value==="All"?l.value:l.value.filter(a=>a.category===M.value)),Me=e.computed(()=>Math.max(150,g.value.length*40+S.top+S.bottom)),U=e.computed(()=>{if(l.value.length===0)return new Date(k.startDate);const a=l.value.map(t=>new Date(t.start));return new Date(Math.min(...a))}),X=e.computed(()=>{if(l.value.length===0)return new Date(k.endDate);const a=l.value.map(n=>new Date(n.end)),t=new Date(Math.max(...a));return t.setDate(t.getDate()+10),t}),Se=()=>{const t=(l.value.length>0?Math.max(...l.value.map(s=>s.id)):0)+1;let n;const o=(l.value.length>0?l.value[l.value.length-1].category:"Planning")||"Uncategorized";if(l.value.length>0){const s=l.value[l.value.length-1],p=new Date(s.end).getTime()-new Date(s.start).getTime(),h=new Date(s.end);h.setDate(h.getDate()+1);const T=new Date(h.getTime()+p);n={id:t,name:`Tâche Copiée ${t}`,start:W(h),end:W(T),category:o,isNew:!0}}else{const s=new Date,p=new Date;p.setDate(p.getDate()+10),n={id:t,name:`Première Tâche ${t}`,start:W(s),end:W(p),category:o,isNew:!0}}l.value.push(n),G(l.value),c("taskUpdated",l.value)},Ie=()=>{if(l.value.length===0)return;const a=Math.max(...l.value.map(n=>n.id)),t=l.value.filter(n=>n.id!==a);l.value=t,c("taskUpdated",l.value)},Ae=()=>{const a=[...l.value].sort((t,n)=>{const o=new Date(t.start),s=new Date(n.start);return o<s?-1:o>s?1:t.id-n.id});l.value=a,c("taskUpdated",l.value)},Be=a=>{const t=l.value.findIndex(n=>n.id===a.id);if(t!==-1){const n={...l.value[t],start:a.newStart,end:a.newEnd,category:l.value[t].category,name:a.name||l.value[t].name},o=[...l.value];o[t]=n,l.value=o,c("taskUpdated",l.value)}},Fe=e.computed(()=>r.value?$(r.value.start,r.value.end):0),_e=e.computed(()=>!r.value||!r.value.y||!B.value?{}:{position:"absolute",left:`${B.value.clientWidth/2}px`,top:`${r.value.y+S.top+5}px`,transform:"translateX(-50%)",zIndex:30,minWidth:"320px"}),v=e.ref(null),w=e.ref(null),ee=a=>{if(L.value=!1,r.value&&r.value.id===a.id){r.value=null,D.value=!1;return}if(!v.value||!w.value)return;const t=v.value(new Date(a.start)),n=w.value(a.name);n!==void 0&&(r.value={id:a.id,name:a.name,start:a.start,end:a.end,durationDays:$(a.start,a.end),x:t,y:n,category:a.category||"Uncategorized",newCategory:null},D.value=!1,e.nextTick(()=>{const o=document.querySelector(".gantt-edit-form input");o&&o.focus()}))};e.watch(()=>{var a;return(a=r.value)==null?void 0:a.durationDays},(a,t)=>{if(r.value&&a){a!==t&&(r.value.end=Y(r.value.start,a));const n=Math.max(1,a);r.value.durationDays=n,r.value.end=Y(r.value.start,n)}}),e.watch(()=>{var a;return(a=r.value)==null?void 0:a.start},(a,t)=>{r.value&&a&&(r.value.end=Y(a,Math.max(1,r.value.durationDays)),a!==t&&(r.value.durationDays=$(a,r.value.end)))});const Le=()=>{const{id:a,name:t,start:n,end:o}=r.value,s=l.value.findIndex(C=>C.id===a);if(s===-1)return;const p=l.value[s];let{category:h}=r.value,T=h;if(D.value&&r.value.newCategory){const C=r.value.newCategory.trim();C&&(T=C)}T!==p.category&&G(l.value.concat([{category:T}])),D.value=!1;const R=new Date(n),A=new Date(o);if(R.getTime()>=A.getTime()){console.error("La tâche doit avoir une durée d'au moins un jour (date de début < date de fin)."),console.warn("Erreur: La date de début doit être strictement antérieure à la date de fin pour garantir une durée positive. Opération annulée.");return}const j={...p,name:t,start:n,end:o,category:T},F=[...l.value];F[s]=j,l.value=F,c("taskUpdated",l.value),r.value=null},Ue=a=>{const t=U.value,n=X.value;v.value=d.scaleTime().domain([t,n]).range([0,a-S.left-S.right]),w.value=d.scaleBand().domain(Array.isArray(g.value)?g.value.map(o=>o.name):[]).range([0,g.value.length*40]).paddingInner(.1)},I=()=>{if(!B.value)return;Q.value=B.value.clientWidth;const a=Q.value;Ue(a);const t=d.select(B.value);t.selectAll("*").remove();const o=t.append("svg").attr("width",a).attr("height",Me.value).append("g").attr("transform",`translate(${S.left}, ${S.top})`);if(o.append("g").attr("transform",`translate(0, ${g.value.length*40||50})`).call(d.axisBottom(v.value)),o.append("g").attr("class","y-axis-g").call(d.axisLeft(w.value)).selectAll(".tick text").style("cursor","pointer").on("contextmenu",function(i,u){i.preventDefault(),i.stopPropagation();const m=u,f=g.value.find(x=>x.name===m);f&&ee(f)}),!g.value.length)return;const h=Ve.value*J,T=d.timeDay.offset(U.value,1),R=v.value(T)-v.value(U.value);let A=!1,j,F,C=-1;const je=w.value.step(),q=M.value!=="All",ze=d.drag().on("start",function(i,u){if(r.value){d.select(this).style("cursor","pointer"),i.sourceEvent.stopPropagation();return}L.value=!1,A=!1,j=i.x,F=i.y,C=g.value.findIndex(m=>m.id===u.id),d.select(this).raise().classed("dragging",!0).style("cursor","grabbing")}).on("drag",function(i,u){if(r.value)return;const m=i.x-j,f=i.y-F;if(Math.abs(f)>5&&!q)A=!0,d.select(this).attr("transform",`translate(0, ${f})`);else if(Math.abs(m)>5||q){L.value=!0,A=!1;const x=v.value(new Date(u.start))+m;d.select(this).select("rect").attr("x",x),d.select(this).select("text").attr("x",x+5),d.select(this).attr("transform",null)}}).on("end",function(i,u){if(d.select(this).style("cursor","grab"),r.value){d.select(this).classed("dragging",!1).attr("transform",null);return}if(d.select(this).classed("dragging",!1).attr("transform",null),A&&!q){const m=w.value(u.name)+(i.y-F),f=Math.round(m/je),x=Math.max(0,Math.min(g.value.length-1,f));if(x!==C){const N=g.value[C].id,E=l.value.findIndex(O=>O.id===N),z=g.value[x].id,H=l.value.findIndex(O=>O.id===z),b=[...l.value],[te]=b.splice(E,1);b.splice(H,0,te),l.value=b,c("taskUpdated",l.value)}else I()}else if(L.value){const m=v.value(new Date(u.start))+(i.x-j),f=v.value.invert(m),x=new Date(u.end).getTime()-new Date(u.start).getTime(),N=new Date(f.getTime()+x),E=d.timeFormat("%Y-%m-%d")(f),z=d.timeFormat("%Y-%m-%d")(N);Be({id:u.id,name:u.name,newStart:E,newEnd:z})}else I();L.value=!1,A=!1});g.value.forEach(i=>{const u=v.value(new Date(i.start)),m=w.value(i.name),f=Z(i);let x,N=!1;if(f>h){N=!0;const b=h*R,O=(f-h)*De*R;x=b+O}else x=v.value(new Date(i.end))-u;const E=o.append("g").datum(i).attr("class","task-group").on("contextmenu",function(b){b.preventDefault(),b.sourceEvent?b.sourceEvent.stopPropagation():b.stopPropagation(),ee(i)}),z=E.append("rect").attr("x",u).attr("y",m).attr("width",x).attr("height",w.value.bandwidth()).attr("fill",Te(i.category)).attr("rx",4).style("cursor","grab");N&&(z.attr("stroke","black").attr("stroke-width",2),E.append("title").text(`Durée réelle: ${f} jours. Affiché plié (Whale Task) car > ${h} jours (${J}x la médiane).`)),ze(E);const H=N?`📐: ${i.name}`:i.name;E.append("text").text(H).attr("x",u+5).attr("y",m+w.value.bandwidth()/2+5).attr("fill","black").style("pointer-events","none").style("font-size","12px").style("font-weight",N?"bold":"normal"),q&&E.append("text").text("🚫").attr("x",-45).attr("y",m+w.value.bandwidth()/2+5).attr("fill","gray").style("font-size","14px").style("cursor","help").attr("title","Réorganisation désactivée en mode filtré")})};return e.watch(()=>k.tasks,a=>{Array.isArray(a)?(l.value=a.map(t=>{const{color:n,...o}=t;return{...o}}),G(l.value),I()):(l.value=[],P.value={},I())},{immediate:!0,deep:!0}),e.onMounted(()=>{I(),window.addEventListener("resize",I)}),e.watch([()=>l.value,U,X,M],I,{deep:!0}),(a,t)=>(e.openBlock(),e.createElementBlock("div",le,[e.createElementVNode("div",re,[e.createElementVNode("div",oe,[t[9]||(t[9]=e.createElementVNode("label",{for:"categoryFilter",class:"text-sm font-medium text-gray-700"},"Filtrer par:",-1)),e.withDirectives(e.createElementVNode("select",{id:"categoryFilter","onUpdate:modelValue":t[0]||(t[0]=n=>M.value=n),class:"p-1 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-sm"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(Ne.value,n=>(e.openBlock(),e.createElementBlock("option",{key:n,value:n},e.toDisplayString(n),9,se))),128))],512),[[e.vModelSelect,M.value]])]),e.createElementVNode("button",{onClick:Se,class:"bg-green-500 hover:bg-green-600 text-gray-500 font-bold py-1 px-2 rounded-full shadow-lg transition duration-150 text-lg leading-none w-8 h-8 flex items-center justify-center",title:"Ajouter une nouvelle tâche (copie de la dernière)"}," + "),e.createElementVNode("button",{onClick:Ae,class:"bg-blue-500 hover:bg-blue-600 text-gray-500 font-bold py-1 px-2 rounded-full shadow-lg transition duration-150 text-sm leading-none w-8 h-8 flex items-center justify-center",title:"Trier par date de début"}," ⇅ "),e.createElementVNode("button",{onClick:Ie,disabled:l.value.length===0,class:"bg-red-500 hover:bg-red-600 disabled:bg-gray-400 text-gray-500 font-bold py-1 px-2 rounded-full shadow-lg transition duration-150 text-lg leading-none w-8 h-8 flex items-center justify-center",title:"Supprimer la dernière tâche (ID max)"}," − ",8,ie)]),e.createElementVNode("div",{ref_key:"ganttContainer",ref:B,class:"relative w-full overflow-x-auto"},[g.value.length===0&&l.value.length>0?(e.openBlock(),e.createElementBlock("div",de,[e.createElementVNode("p",ue," Aucune tâche ne correspond au filtre '"+e.toDisplayString(M.value)+"'. ",1)])):l.value.length===0?(e.openBlock(),e.createElementBlock("div",ce,[...t[10]||(t[10]=[e.createElementVNode("p",{class:"text-xl font-semibold text-gray-600 p-4 bg-white rounded-lg shadow-lg"}," Le tableau de tâches est vide. Utilisez '+' pour commencer ! ",-1)])])):e.createCommentVNode("",!0)],512),e.createElementVNode("div",null,[e.createElementVNode("p",me," Dates du graphique calculées : "+e.toDisplayString(d.timeFormat("%Y-%m-%d")(U.value))+" à "+e.toDisplayString(d.timeFormat("%Y-%m-%d")(X.value)),1),t[11]||(t[11]=e.createElementVNode("p",{class:"text-xs text-blue-500 font-medium"}," (CONSEIL: **Cliquez-droit** sur une barre de tâche pour l'éditer. Les tâches **Whales** (durée > 5x médiane) sont **compressées** et marquées par un **📐: ** dans leur nom. **Glissez verticalement** pour réordonner (désactivé si un filtre est appliqué).) ",-1))]),r.value?(e.openBlock(),e.createElementBlock("div",{key:0,style:e.normalizeStyle(_e.value),class:"gantt-edit-form p-4 border border-blue-400 rounded-lg shadow-xl flex flex-col space-y-2 z-50"},[t[17]||(t[17]=e.createElementVNode("div",{class:"text-sm font-semibold text-gray-700 mb-2"},"Éditer",-1)),e.createElementVNode("label",fe,[t[12]||(t[12]=e.createTextVNode(" Nom: ",-1)),e.withDirectives(e.createElementVNode("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=n=>r.value.name=n),class:"mt-1 p-1 border rounded-md w-full text-sm focus:ring-blue-500 focus:border-blue-500"},null,512),[[e.vModelText,r.value.name]])]),e.createElementVNode("label",ge,[t[13]||(t[13]=e.createTextVNode(" Catégorie: ",-1)),D.value?e.withDirectives((e.openBlock(),e.createElementBlock("input",{key:1,type:"text","onUpdate:modelValue":t[3]||(t[3]=n=>r.value.newCategory=n),placeholder:"Nouvelle catégorie...",class:"p-1 border border-blue-500 rounded-md w-full text-sm focus:ring-blue-500 focus:border-blue-500"},null,512)),[[e.vModelText,r.value.newCategory]]):e.withDirectives((e.openBlock(),e.createElementBlock("select",{key:0,"onUpdate:modelValue":t[2]||(t[2]=n=>r.value.category=n),class:"p-1 border rounded-md w-full text-sm focus:ring-blue-500 focus:border-blue-500"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(Ce.value,n=>(e.openBlock(),e.createElementBlock("option",{key:n,value:n},e.toDisplayString(n),9,pe))),128))],512)),[[e.vModelSelect,r.value.category]]),e.createElementVNode("button",{onClick:t[4]||(t[4]=n=>D.value=!D.value),type:"button",class:"text-gray-500 hover:text-blue-600 font-bold w-6 h-6 flex items-center justify-center border rounded-full transition duration-150",title:D.value?"Annuler l'entrée":"Créer une nouvelle catégorie"},e.toDisplayString(D.value?"×":"+"),9,xe)]),t[18]||(t[18]=e.createElementVNode("hr",{class:"border-gray-200 my-1"},null,-1)),e.createElementVNode("label",ye,[t[14]||(t[14]=e.createTextVNode(" Durée (jours): ",-1)),e.withDirectives(e.createElementVNode("input",{type:"number","onUpdate:modelValue":t[5]||(t[5]=n=>r.value.durationDays=n),min:"1",class:"mt-1 p-1 border rounded-md w-full text-sm focus:ring-blue-500 focus:border-blue-500"},null,512),[[e.vModelText,r.value.durationDays,void 0,{number:!0}]])]),e.createElementVNode("label",ve,[t[15]||(t[15]=e.createTextVNode(" Début: ",-1)),e.withDirectives(e.createElementVNode("input",{type:"date","onUpdate:modelValue":t[6]||(t[6]=n=>r.value.start=n),class:"mt-1 p-1 border rounded-md w-full text-sm focus:ring-blue-500 focus:border-blue-500"},null,512),[[e.vModelText,r.value.start]])]),e.createElementVNode("label",he,[t[16]||(t[16]=e.createTextVNode(" Fin: ",-1)),e.withDirectives(e.createElementVNode("input",{type:"date","onUpdate:modelValue":t[7]||(t[7]=n=>r.value.end=n),class:"mt-1 p-1 border rounded-md w-full text-sm focus:ring-blue-500 focus:border-blue-500"},null,512),[[e.vModelText,r.value.end]])]),e.createElementVNode("div",be,[e.createElementVNode("span",we," Durée effective: "+e.toDisplayString(Fe.value)+" j. ",1)]),e.createElementVNode("button",{onClick:Le,class:"bg-blue-600 hover:bg-blue-700 text-gray-500 text-xs font-bold py-1 px-3 rounded-md transition duration-150"}," Valider "),e.createElementVNode("button",{onClick:t[8]||(t[8]=n=>r.value=null),class:"absolute top-1 right-1 text-gray-500 hover:text-gray-800 text-xs"}," × ")],4)):e.createCommentVNode("",!0)]))}},[["__scopeId","data-v-d17387a0"]]);return{install(y){y.component("GanttChart",Ee)}}});
