(function(e,D){typeof exports=="object"&&typeof module<"u"?module.exports=D(require("vue"),require("d3")):typeof define=="function"&&define.amd?define(["vue","d3"],D):(e=typeof globalThis<"u"?globalThis:e||self,e.GanttLib=D(e.Vue,e.d3))})(this,function(e,D){"use strict";function M(d){const v=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(d){for(const u in d)if(u!=="default"){const r=Object.getOwnPropertyDescriptor(d,u);Object.defineProperty(v,u,r.get?r:{enumerable:!0,get:()=>d[u]})}}return v.default=d,Object.freeze(v)}const i=M(D),z=(d,v)=>{const u=d.__vccOpts||d;for(const[r,b]of v)u[r]=b;return u},B={class:"gantt-wrapper relative w-full"},F={class:"font-bold mb-1"},$={class:"mt-1 font-medium"},A={class:"text-sm font-semibold text-gray-700 mb-2"},I={class:"text-xs font-medium text-gray-600"},L={class:"text-xs font-medium text-gray-600"},O={class:"text-xs font-medium text-gray-600"},P={class:"mt-3 flex justify-between items-center"},G={class:"text-xs font-bold text-blue-600"},Y=z({__name:"GanttChart",props:{tasks:{type:Array,default:()=>[]},startDate:{type:String,default:"2012-12-12"},endDate:{type:String,default:"2013-12-13"}},emits:["task-moved"],setup(d,{emit:v}){const u=d,r=e.ref([]),b=e.ref(null),k=e.ref(0),c={top:40,right:20,bottom:30,left:50},q=e.computed(()=>Math.max(150,r.value.length*40+c.top+c.bottom)),w=e.ref(!1),a=e.ref(null),f=e.ref(null),V=e.ref({x:0,y:0}),U=e.computed(()=>({position:"absolute",left:`${V.value.x}px`,top:`${V.value.y}px`,transform:"translateY(-100%) translateX(-50%)",pointerEvents:"none"})),T=(t,n)=>{if(!t||!n)return 0;const l=new Date(t),s=new Date(n);if(l.getTime()>s.getTime())return 0;const p=Math.abs(s.getTime()-l.getTime());return Math.ceil(p/(1e3*60*60*24))+1},C=(t,n)=>{if(!t||n<=0)return t;const l=new Date(t);return l.setDate(l.getDate()+n-1),i.timeFormat("%Y-%m-%d")(l)},j=t=>{const n=r.value.findIndex(l=>l.id===t.id);if(n!==-1){const l={...r.value[n],start:t.newStart,end:t.newEnd},s=[...r.value];s[n]=l,r.value=s}},W=e.computed(()=>a.value?T(a.value.start,a.value.end):0),X=e.computed(()=>{if(!a.value||!a.value.x||!a.value.y)return{};const t=c.left;return{position:"absolute",left:`${a.value.x+t}px`,top:`${a.value.y+c.top+5}px`,transform:"translateX(-50%)",zIndex:30,minWidth:"320px"}}),H=(t,n)=>{if(w.value||a.value)return;const l=g.value(new Date(t.start)),s=x.value(t.name);a.value={id:t.id,name:t.name,start:t.start,end:t.end,durationDays:T(t.start,t.end),x:l,y:s},e.nextTick(()=>{const p=document.querySelector(".gantt-edit-form input");p&&p.focus()})};e.watch(()=>{var t;return(t=a.value)==null?void 0:t.durationDays},(t,n)=>{a.value&&t&&t!==n&&(a.value.end=C(a.value.start,t))}),e.watch(()=>{var t;return(t=a.value)==null?void 0:t.start},(t,n)=>{a.value&&t&&t!==n&&(a.value.durationDays=T(t,a.value.end)),a.value&&t&&(a.value.end=C(t,a.value.durationDays))});const J=()=>{const{id:t,name:n,start:l,end:s}=a.value,p=new Date(l),o=new Date(s);if(p.getTime()>=o.getTime()){console.error("La date de début doit être strictement antérieure à la date de fin."),alert("Erreur: La date de début doit être antérieure à la date de fin.");return}j({id:t,newStart:l,newEnd:s}),a.value=null},g=e.ref(null),x=e.ref(null),K=t=>{const n=new Date(u.startDate),l=new Date(u.endDate);g.value=i.scaleTime().domain([n,l]).range([0,t-c.left-c.right]),x.value=i.scaleBand().domain(Array.isArray(r.value)?r.value.map(s=>s.name):[]).range([0,r.value.length*40]).paddingInner(.1)},h=()=>{if(!b.value)return;k.value=b.value.clientWidth;const t=k.value;K(t);const n=i.select(b.value);n.selectAll("*").remove();const s=n.append("svg").attr("width",t).attr("height",q.value).append("g").attr("transform",`translate(${c.left}, ${c.top})`);if(s.append("g").attr("transform",`translate(0, ${r.value.length*40||50})`).call(i.axisBottom(g.value)),s.append("g").call(i.axisLeft(x.value)),!r.value.length)return;const p=i.drag().on("start",function(o,m){w.value=!1,i.select(this).raise().classed("dragging",!0)}).on("drag",function(o,m){w.value=!0;const E=o.x;i.select(this).attr("x",E)}).on("end",function(o,m){if(i.select(this).classed("dragging",!1),w.value){const E=g.value.invert(o.x),N=new Date(m.end).getTime()-new Date(m.start).getTime(),_=new Date(E.getTime()+N),S=i.timeFormat("%Y-%m-%d")(E),y=i.timeFormat("%Y-%m-%d")(_);j({id:m.id,name:m.name,newStart:S,newEnd:y})}w.value=!1});r.value.forEach(o=>{const m=g.value(new Date(o.start)),N=g.value(new Date(o.end))-m,_=x.value(o.name),S=s.append("rect").datum(o).attr("x",m).attr("y",_).attr("width",N).attr("height",x.value.bandwidth()).attr("fill",o.color).attr("rx",4).style("cursor","grab").on("mouseenter",(y,Q)=>{const[R,Z]=i.pointer(y);f.value=Q,V.value={x:R+c.left,y:Z+c.top},i.select(y.currentTarget).style("filter","brightness(1.1)")}).on("mouseleave",y=>{f.value=null,i.select(y.currentTarget).style("filter","none")}).on("dblclick",function(y){H(o)});p(S)}),s.selectAll(".task-label").data(r.value).enter().append("text").text(o=>o.name).attr("x",o=>g.value(new Date(o.start))+5).attr("y",o=>x.value(o.name)+x.value.bandwidth()/2+5).attr("fill","black").style("pointer-events","none").style("font-size","12px")};return e.watch(()=>u.tasks,t=>{Array.isArray(t)?(r.value=t.map(n=>({...n})),h()):(r.value=[],h())},{immediate:!0,deep:!0}),e.onMounted(()=>{h(),window.addEventListener("resize",h)}),e.watch(()=>r.value,()=>{h()}),(t,n)=>(e.openBlock(),e.createElementBlock("div",B,[e.createElementVNode("div",{ref_key:"ganttContainer",ref:b,class:"relative w-full overflow-x-auto"},null,512),f.value?(e.openBlock(),e.createElementBlock("div",{key:0,style:e.normalizeStyle(U.value),class:"bg-gray-800 text-white text-xs p-2 rounded-lg shadow-xl opacity-90 transition duration-150 z-40"},[e.createElementVNode("div",F,e.toDisplayString(f.value.name),1),e.createElementVNode("div",null,"Début: "+e.toDisplayString(f.value.start),1),e.createElementVNode("div",null,"Fin: "+e.toDisplayString(f.value.end),1),e.createElementVNode("div",$,"Durée: "+e.toDisplayString(T(f.value.start,f.value.end))+" jours",1)],4)):e.createCommentVNode("",!0),a.value?(e.openBlock(),e.createElementBlock("div",{key:1,style:e.normalizeStyle(X.value),class:"gantt-edit-form p-4 border border-blue-400 rounded-lg shadow-xl flex flex-col space-y-2 z-50"},[e.createElementVNode("div",A,"Éditer: "+e.toDisplayString(a.value.name),1),e.createElementVNode("label",I,[n[4]||(n[4]=e.createTextVNode(" Durée (jours): ",-1)),e.withDirectives(e.createElementVNode("input",{type:"number","onUpdate:modelValue":n[0]||(n[0]=l=>a.value.durationDays=l),min:"1",class:"mt-1 p-1 border rounded-md w-full text-sm focus:ring-blue-500 focus:border-blue-500"},null,512),[[e.vModelText,a.value.durationDays,void 0,{number:!0}]])]),n[7]||(n[7]=e.createElementVNode("hr",{class:"border-gray-200 my-1"},null,-1)),e.createElementVNode("label",L,[n[5]||(n[5]=e.createTextVNode(" Début: ",-1)),e.withDirectives(e.createElementVNode("input",{type:"date","onUpdate:modelValue":n[1]||(n[1]=l=>a.value.start=l),class:"mt-1 p-1 border rounded-md w-full text-sm focus:ring-blue-500 focus:border-blue-500"},null,512),[[e.vModelText,a.value.start]])]),e.createElementVNode("label",O,[n[6]||(n[6]=e.createTextVNode(" Fin: ",-1)),e.withDirectives(e.createElementVNode("input",{type:"date","onUpdate:modelValue":n[2]||(n[2]=l=>a.value.end=l),class:"mt-1 p-1 border rounded-md w-full text-sm focus:ring-blue-500 focus:border-blue-500"},null,512),[[e.vModelText,a.value.end]])]),e.createElementVNode("div",P,[e.createElementVNode("span",G," Durée effective: "+e.toDisplayString(W.value)+" j. ",1),e.createElementVNode("button",{onClick:J,class:"bg-blue-600 hover:bg-blue-700 text-white text-xs font-bold py-1 px-3 rounded-md transition duration-150"}," Valider ")]),e.createElementVNode("button",{onClick:n[3]||(n[3]=l=>a.value=null),class:"absolute top-1 right-1 text-gray-500 hover:text-gray-800 text-xs"}," × ")],4)):e.createCommentVNode("",!0)]))}},[["__scopeId","data-v-59e9c80e"]]);return{install(d){d.component("GanttChart",Y)}}});
