(function(e,_){typeof exports=="object"&&typeof module<"u"?module.exports=_(require("vue"),require("d3")):typeof define=="function"&&define.amd?define(["vue","d3"],_):(e=typeof globalThis<"u"?globalThis:e||self,e.GanttLib=_(e.Vue,e.d3))})(this,function(e,_){"use strict";function te(f){const V=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(f){for(const u in f)if(u!=="default"){const T=Object.getOwnPropertyDescriptor(f,u);Object.defineProperty(V,u,T.get?T:{enumerable:!0,get:()=>f[u]})}}return V.default=f,Object.freeze(V)}const i=te(_),ae=(f,V)=>{const u=f.__vccOpts||f;for(const[T,l]of V)u[T]=l;return u},ne={class:"gantt-wrapper relative w-full"},le={class:"absolute top-0 right-0 z-10 flex space-x-4 items-center mr-2"},re={class:"flex items-center space-x-2"},oe=["value"],se=["disabled"],ie={key:0,class:"absolute inset-0 flex items-center justify-center bg-gray-50/50 z-20"},de={class:"text-xl font-semibold text-gray-600 p-4 bg-white rounded-lg shadow-lg"},ce={key:1,class:"absolute inset-0 flex items-center justify-center bg-gray-50/50 z-20"},ue={class:"text-xs text-gray-500 mt-2"},me={class:"text-xs font-medium text-gray-600"},fe={class:"text-xs font-medium text-gray-600"},ge=["value"],pe=["title"],xe={class:"text-xs font-medium text-gray-600"},ye={class:"text-xs font-medium text-gray-600"},ve={class:"text-xs font-medium text-gray-600"},be={class:"mt-3 flex justify-between items-center"},he={class:"text-xs font-bold text-blue-600"},H=5,we=.2,De=ae({__name:"GanttChart",props:{tasks:{type:Array,default:()=>[]},startDate:{type:String,default:"2012-12-12"},endDate:{type:String,default:"2013-12-13"}},emits:["taskUpdated"],setup(f,{emit:V}){const u=V,T=f,l=e.ref([]),N=e.ref("All"),J=["#4F46E5","#10B981","#F59E0B","#EF4444","#6366F1","#EC4899","#06B6D4"],$=e.ref({}),Ee=a=>{if(a.length===0)return 1;const t=[...a].sort((o,s)=>o-s),n=Math.floor(t.length/2);return t.length%2===0?(t[n-1]+t[n])/2:t[n]},Y=a=>{const t=new Set;a.forEach(s=>{s.category&&s.category.trim()&&t.add(s.category)});let n={...$.value},o=0;t.forEach(s=>{if(!n[s]){let c=J[o%J.length];n[s]=c}o++}),$.value=n},Te=a=>!a||a==="Uncategorized"?"#9CA3AF":$.value[a]||"#9CA3AF",w=e.ref(!1),ke=e.computed(()=>{const a=new Set;return l.value.forEach(t=>{t.category&&t.category.trim()&&a.add(t.category)}),Array.from(a).sort()}),Ce=e.computed(()=>{const a=new Set(["All"]);return l.value.forEach(t=>{t.category&&t.category.trim()&&a.add(t.category)}),Array.from(a).sort()}),B=e.ref(null),K=e.ref(0),M={top:40,right:20,bottom:30,left:50},L=e.ref(!1),r=e.ref(null),W=(a,t)=>{if(!a||!t)return 0;const n=new Date(a),o=new Date(t);if(n.getTime()>o.getTime())return 0;const s=Math.abs(o.getTime()-n.getTime());return Math.ceil(s/(1e3*60*60*24))+1},Q=a=>W(a.start,a.end),Ve=e.computed(()=>{if(l.value.length===0)return 1;const a=l.value.filter(t=>t.start&&t.end).map(Q);return Math.max(1,Ee(a))}),Z=(a,t)=>{if(!a||t<=0)return a;const n=new Date(a);return n.setDate(n.getDate()+t-1),i.timeFormat("%Y-%m-%d")(n)},R=a=>a.toISOString().split("T")[0],g=e.computed(()=>N.value==="All"?l.value:l.value.filter(a=>a.category===N.value)),Ne=e.computed(()=>Math.max(150,g.value.length*40+M.top+M.bottom)),U=e.computed(()=>{if(l.value.length===0)return new Date(T.startDate);const a=l.value.map(t=>new Date(t.start));return new Date(Math.min(...a))}),G=e.computed(()=>{if(l.value.length===0)return new Date(T.endDate);const a=l.value.map(n=>new Date(n.end)),t=new Date(Math.max(...a));return t.setDate(t.getDate()+10),t}),Me=()=>{const t=(l.value.length>0?Math.max(...l.value.map(s=>s.id)):0)+1;let n;const o=(l.value.length>0?l.value[l.value.length-1].category:"Planning")||"Uncategorized";if(l.value.length>0){const s=l.value[l.value.length-1],c=new Date(s.end).getTime()-new Date(s.start).getTime(),k=new Date(s.end);k.setDate(k.getDate()+1);const D=new Date(k.getTime()+c);n={id:t,name:`Tâche Copiée ${t}`,start:R(k),end:R(D),category:o,isNew:!0}}else{const s=new Date,c=new Date;c.setDate(c.getDate()+10),n={id:t,name:`Première Tâche ${t}`,start:R(s),end:R(c),category:o,isNew:!0}}l.value.push(n),Y(l.value),u("taskUpdated",l.value)},Se=()=>{if(l.value.length===0)return;const a=Math.max(...l.value.map(n=>n.id)),t=l.value.filter(n=>n.id!==a);l.value=t,u("taskUpdated",l.value)},Ie=()=>{const a=[...l.value].sort((t,n)=>{const o=new Date(t.start),s=new Date(n.start);return o<s?-1:o>s?1:t.id-n.id});l.value=a,u("taskUpdated",l.value)},Be=a=>{const t=l.value.findIndex(n=>n.id===a.id);if(t!==-1){const n={...l.value[t],start:a.newStart,end:a.newEnd,category:l.value[t].category,name:a.name||l.value[t].name},o=[...l.value];o[t]=n,l.value=o,u("taskUpdated",l.value)}},Fe=e.computed(()=>r.value?W(r.value.start,r.value.end):0),Ae=e.computed(()=>!r.value||!r.value.y||!B.value?{}:{position:"absolute",left:`${B.value.clientWidth/2}px`,top:`${r.value.y+M.top+5}px`,transform:"translateX(-50%)",zIndex:30,minWidth:"320px"}),x=e.ref(null),h=e.ref(null),_e=a=>{if(L.value=!1,r.value&&r.value.id===a.id){r.value=null,w.value=!1;return}if(!x.value||!h.value)return;const t=x.value(new Date(a.start)),n=h.value(a.name);n!==void 0&&(r.value={id:a.id,name:a.name,start:a.start,end:a.end,durationDays:W(a.start,a.end),x:t,y:n,category:a.category||"Uncategorized",newCategory:null},w.value=!1,e.nextTick(()=>{const o=document.querySelector(".gantt-edit-form input");o&&o.focus()}))};e.watch(()=>{var a;return(a=r.value)==null?void 0:a.durationDays},(a,t)=>{r.value&&a&&a!==t&&(r.value.end=Z(r.value.start,a))}),e.watch(()=>{var a;return(a=r.value)==null?void 0:a.start},(a,t)=>{r.value&&a&&a!==t&&(r.value.durationDays=W(a,r.value.end)),r.value&&a&&(r.value.end=Z(a,r.value.durationDays))});const Le=()=>{const{id:a,name:t,start:n,end:o}=r.value,s=l.value.findIndex(A=>A.id===a);if(s===-1)return;const c=l.value[s];let{category:k}=r.value,D=k;if(w.value&&r.value.newCategory){const A=r.value.newCategory.trim();A&&(D=A)}D!==c.category&&Y(l.value.concat([{category:D}])),w.value=!1;const I=new Date(n),j=new Date(o);if(I.getTime()>=j.getTime()){console.error("La date de début doit être strictement antérieure à la date de fin."),console.warn("Erreur: La date de début doit être antérieure à la date de fin. Opération annulée.");return}const z={...c,name:t,start:n,end:o,category:D},F=[...l.value];F[s]=z,l.value=F,u("taskUpdated",l.value),r.value=null},Ue=a=>{const t=U.value,n=G.value;x.value=i.scaleTime().domain([t,n]).range([0,a-M.left-M.right]),h.value=i.scaleBand().domain(Array.isArray(g.value)?g.value.map(o=>o.name):[]).range([0,g.value.length*40]).paddingInner(.1)},S=()=>{if(!B.value)return;K.value=B.value.clientWidth;const a=K.value;Ue(a);const t=i.select(B.value);t.selectAll("*").remove();const o=t.append("svg").attr("width",a).attr("height",Ne.value).append("g").attr("transform",`translate(${M.left}, ${M.top})`);if(o.append("g").attr("transform",`translate(0, ${g.value.length*40||50})`).call(i.axisBottom(x.value)),o.append("g").attr("class","y-axis-g").call(i.axisLeft(h.value)),!g.value.length)return;const c=Ve.value*H,k=i.timeDay.offset(U.value,1),D=x.value(k)-x.value(U.value);let I=!1,j,z,F=-1;const A=h.value.step(),q=N.value!=="All",je=i.drag().on("start",function(d,m){if(r.value){i.select(this).style("cursor","pointer"),d.sourceEvent.stopPropagation();return}L.value=!1,I=!1,j=d.x,z=d.y,F=g.value.findIndex(p=>p.id===m.id),i.select(this).raise().classed("dragging",!0).style("cursor","grabbing")}).on("drag",function(d,m){if(r.value)return;const p=d.x-j,y=d.y-z;if(Math.abs(y)>5&&!q)I=!0,i.select(this).attr("transform",`translate(0, ${y})`);else if(Math.abs(p)>5||q){L.value=!0,I=!1;const v=x.value(new Date(m.start))+p;i.select(this).select("rect").attr("x",v),i.select(this).select("text").attr("x",v+5),i.select(this).attr("transform",null)}}).on("end",function(d,m){if(i.select(this).style("cursor","grab"),r.value){i.select(this).classed("dragging",!1).attr("transform",null);return}if(i.select(this).classed("dragging",!1).attr("transform",null),I&&!q){const p=h.value(m.name)+(d.y-z),y=Math.round(p/A),v=Math.max(0,Math.min(g.value.length-1,y));if(v!==F){const C=g.value[F].id,E=l.value.findIndex(P=>P.id===C),O=g.value[v].id,X=l.value.findIndex(P=>P.id===O),b=[...l.value],[ee]=b.splice(E,1);b.splice(X,0,ee),l.value=b,u("taskUpdated",l.value)}else S()}else if(L.value){const p=x.value(new Date(m.start))+(d.x-j),y=x.value.invert(p),v=new Date(m.end).getTime()-new Date(m.start).getTime(),C=new Date(y.getTime()+v),E=i.timeFormat("%Y-%m-%d")(y),O=i.timeFormat("%Y-%m-%d")(C);Be({id:m.id,name:m.name,newStart:E,newEnd:O})}else S();L.value=!1,I=!1});g.value.forEach(d=>{const m=x.value(new Date(d.start)),p=h.value(d.name),y=Q(d);let v,C=!1;if(y>c){C=!0;const b=c*D,P=(y-c)*we*D;v=b+P}else v=x.value(new Date(d.end))-m;const E=o.append("g").datum(d).attr("class","task-group").on("contextmenu",function(b){b.preventDefault(),b.sourceEvent?b.sourceEvent.stopPropagation():b.stopPropagation(),_e(d)}),O=E.append("rect").attr("x",m).attr("y",p).attr("width",v).attr("height",h.value.bandwidth()).attr("fill",Te(d.category)).attr("rx",4).style("cursor","grab");C&&(O.attr("stroke","black").attr("stroke-width",2),E.append("title").text(`Durée réelle: ${y} jours. Affiché plié (Whale Task) car > ${c} jours (${H}x la médiane).`)),je(E);const X=C?`📐: ${d.name}`:d.name;E.append("text").text(X).attr("x",m+5).attr("y",p+h.value.bandwidth()/2+5).attr("fill","black").style("pointer-events","none").style("font-size","12px").style("font-weight",C?"bold":"normal"),q&&E.append("text").text("🚫").attr("x",-45).attr("y",p+h.value.bandwidth()/2+5).attr("fill","gray").style("font-size","14px").style("cursor","help").attr("title","Réorganisation désactivée en mode filtré")})};return e.watch(()=>T.tasks,a=>{Array.isArray(a)?(l.value=a.map(t=>{const{color:n,...o}=t;return{...o}}),Y(l.value),S()):(l.value=[],$.value={},S())},{immediate:!0,deep:!0}),e.onMounted(()=>{S(),window.addEventListener("resize",S)}),e.watch([()=>l.value,U,G,N],S,{deep:!0}),(a,t)=>(e.openBlock(),e.createElementBlock("div",ne,[e.createElementVNode("div",le,[e.createElementVNode("div",re,[t[9]||(t[9]=e.createElementVNode("label",{for:"categoryFilter",class:"text-sm font-medium text-gray-700"},"Filtrer par:",-1)),e.withDirectives(e.createElementVNode("select",{id:"categoryFilter","onUpdate:modelValue":t[0]||(t[0]=n=>N.value=n),class:"p-1 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-sm"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(Ce.value,n=>(e.openBlock(),e.createElementBlock("option",{key:n,value:n},e.toDisplayString(n),9,oe))),128))],512),[[e.vModelSelect,N.value]])]),e.createElementVNode("button",{onClick:Me,class:"bg-green-500 hover:bg-green-600 text-gray-500 font-bold py-1 px-2 rounded-full shadow-lg transition duration-150 text-lg leading-none w-8 h-8 flex items-center justify-center",title:"Ajouter une nouvelle tâche (copie de la dernière)"}," + "),e.createElementVNode("button",{onClick:Ie,class:"bg-blue-500 hover:bg-blue-600 text-gray-500 font-bold py-1 px-2 rounded-full shadow-lg transition duration-150 text-sm leading-none w-8 h-8 flex items-center justify-center",title:"Trier par date de début"}," ⇅ "),e.createElementVNode("button",{onClick:Se,disabled:l.value.length===0,class:"bg-red-500 hover:bg-red-600 disabled:bg-gray-400 text-gray-500 font-bold py-1 px-2 rounded-full shadow-lg transition duration-150 text-lg leading-none w-8 h-8 flex items-center justify-center",title:"Supprimer la dernière tâche (ID max)"}," − ",8,se)]),e.createElementVNode("div",{ref_key:"ganttContainer",ref:B,class:"relative w-full overflow-x-auto"},[g.value.length===0&&l.value.length>0?(e.openBlock(),e.createElementBlock("div",ie,[e.createElementVNode("p",de," Aucune tâche ne correspond au filtre '"+e.toDisplayString(N.value)+"'. ",1)])):l.value.length===0?(e.openBlock(),e.createElementBlock("div",ce,[...t[10]||(t[10]=[e.createElementVNode("p",{class:"text-xl font-semibold text-gray-600 p-4 bg-white rounded-lg shadow-lg"}," Le tableau de tâches est vide. Utilisez '+' pour commencer ! ",-1)])])):e.createCommentVNode("",!0)],512),e.createElementVNode("div",null,[e.createElementVNode("p",ue," Dates du graphique calculées : "+e.toDisplayString(i.timeFormat("%Y-%m-%d")(U.value))+" à "+e.toDisplayString(i.timeFormat("%Y-%m-%d")(G.value)),1),t[11]||(t[11]=e.createElementVNode("p",{class:"text-xs text-blue-500 font-medium"}," (CONSEIL: **Cliquez-droit** sur une barre de tâche pour l'éditer. Les tâches **Whales** (durée > 5x médiane) sont **compressées** et marquées par un **📐: ** dans leur nom. **Glissez verticalement** pour réordonner (désactivé si un filtre est appliqué).) ",-1))]),r.value?(e.openBlock(),e.createElementBlock("div",{key:0,style:e.normalizeStyle(Ae.value),class:"gantt-edit-form p-4 border border-blue-400 rounded-lg shadow-xl flex flex-col space-y-2 z-50"},[t[17]||(t[17]=e.createElementVNode("div",{class:"text-sm font-semibold text-gray-700 mb-2"},"Éditer",-1)),e.createElementVNode("label",me,[t[12]||(t[12]=e.createTextVNode(" Nom: ",-1)),e.withDirectives(e.createElementVNode("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=n=>r.value.name=n),class:"mt-1 p-1 border rounded-md w-full text-sm focus:ring-blue-500 focus:border-blue-500"},null,512),[[e.vModelText,r.value.name]])]),e.createElementVNode("label",fe,[t[13]||(t[13]=e.createTextVNode(" Catégorie: ",-1)),w.value?e.withDirectives((e.openBlock(),e.createElementBlock("input",{key:1,type:"text","onUpdate:modelValue":t[3]||(t[3]=n=>r.value.newCategory=n),placeholder:"Nouvelle catégorie...",class:"p-1 border border-blue-500 rounded-md w-full text-sm focus:ring-blue-500 focus:border-blue-500"},null,512)),[[e.vModelText,r.value.newCategory]]):e.withDirectives((e.openBlock(),e.createElementBlock("select",{key:0,"onUpdate:modelValue":t[2]||(t[2]=n=>r.value.category=n),class:"p-1 border rounded-md w-full text-sm focus:ring-blue-500 focus:border-blue-500"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(ke.value,n=>(e.openBlock(),e.createElementBlock("option",{key:n,value:n},e.toDisplayString(n),9,ge))),128))],512)),[[e.vModelSelect,r.value.category]]),e.createElementVNode("button",{onClick:t[4]||(t[4]=n=>w.value=!w.value),type:"button",class:"text-gray-500 hover:text-blue-600 font-bold w-6 h-6 flex items-center justify-center border rounded-full transition duration-150",title:w.value?"Annuler l'entrée":"Créer une nouvelle catégorie"},e.toDisplayString(w.value?"×":"+"),9,pe)]),t[18]||(t[18]=e.createElementVNode("hr",{class:"border-gray-200 my-1"},null,-1)),e.createElementVNode("label",xe,[t[14]||(t[14]=e.createTextVNode(" Durée (jours): ",-1)),e.withDirectives(e.createElementVNode("input",{type:"number","onUpdate:modelValue":t[5]||(t[5]=n=>r.value.durationDays=n),min:"1",class:"mt-1 p-1 border rounded-md w-full text-sm focus:ring-blue-500 focus:border-blue-500"},null,512),[[e.vModelText,r.value.durationDays,void 0,{number:!0}]])]),e.createElementVNode("label",ye,[t[15]||(t[15]=e.createTextVNode(" Début: ",-1)),e.withDirectives(e.createElementVNode("input",{type:"date","onUpdate:modelValue":t[6]||(t[6]=n=>r.value.start=n),class:"mt-1 p-1 border rounded-md w-full text-sm focus:ring-blue-500 focus:border-blue-500"},null,512),[[e.vModelText,r.value.start]])]),e.createElementVNode("label",ve,[t[16]||(t[16]=e.createTextVNode(" Fin: ",-1)),e.withDirectives(e.createElementVNode("input",{type:"date","onUpdate:modelValue":t[7]||(t[7]=n=>r.value.end=n),class:"mt-1 p-1 border rounded-md w-full text-sm focus:ring-blue-500 focus:border-blue-500"},null,512),[[e.vModelText,r.value.end]])]),e.createElementVNode("div",be,[e.createElementVNode("span",he," Durée effective: "+e.toDisplayString(Fe.value)+" j. ",1)]),e.createElementVNode("button",{onClick:Le,class:"bg-blue-600 hover:bg-blue-700 text-gray-500 text-xs font-bold py-1 px-3 rounded-md transition duration-150"}," Valider "),e.createElementVNode("button",{onClick:t[8]||(t[8]=n=>r.value=null),class:"absolute top-1 right-1 text-gray-500 hover:text-gray-800 text-xs"}," × ")],4)):e.createCommentVNode("",!0)]))}},[["__scopeId","data-v-2331ccc0"]]);return{install(f){f.component("GanttChart",De)}}});
