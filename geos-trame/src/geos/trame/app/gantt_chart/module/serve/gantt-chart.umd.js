(function(e,b){typeof exports=="object"&&typeof module<"u"?module.exports=b(require("vue"),require("d3")):typeof define=="function"&&define.amd?define(["vue","d3"],b):(e=typeof globalThis<"u"?globalThis:e||self,e.GanttLib=b(e.Vue,e.d3))})(this,function(e,b){"use strict";function z(i){const y=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(i){for(const c in i)if(c!=="default"){const f=Object.getOwnPropertyDescriptor(i,c);Object.defineProperty(y,c,f.get?f:{enumerable:!0,get:()=>i[c]})}}return y.default=i,Object.freeze(y)}const d=z(b),B=(i,y)=>{const c=i.__vccOpts||i;for(const[f,s]of y)c[f]=s;return c},F={class:"gantt-wrapper relative w-full"},$={class:"font-bold mb-1"},A={class:"mt-1 font-medium"},I={class:"text-sm font-semibold text-gray-700 mb-2"},L={class:"text-xs font-medium text-gray-600"},O={class:"text-xs font-medium text-gray-600"},P={class:"text-xs font-medium text-gray-600"},U={class:"mt-3 flex justify-between items-center"},G={class:"text-xs font-bold text-blue-600"},Y=B({__name:"GanttChart",props:{tasks:{type:Array,default:()=>[]},startDate:{type:String,default:"2012-12-12"},endDate:{type:String,default:"2013-12-13"}},emits:["taskUpdated"],setup(i,{emit:y}){const c=y,f=i,s=e.ref([]),V=e.ref(null),C=e.ref(0),u={top:40,right:20,bottom:30,left:50},q=e.computed(()=>Math.max(150,s.value.length*40+u.top+u.bottom)),D=e.ref(!1),a=e.ref(null),p=e.ref(null),N=e.ref({x:0,y:0}),W=e.computed(()=>({position:"absolute",left:`${N.value.x}px`,top:`${N.value.y}px`,transform:"translateY(-100%) translateX(-50%)",pointerEvents:"none"})),T=(t,n)=>{if(!t||!n)return 0;const l=new Date(t),o=new Date(n);if(l.getTime()>o.getTime())return 0;const h=Math.abs(o.getTime()-l.getTime());return Math.ceil(h/(1e3*60*60*24))+1},j=(t,n)=>{if(!t||n<=0)return t;const l=new Date(t);return l.setDate(l.getDate()+n-1),d.timeFormat("%Y-%m-%d")(l)},M=t=>{const n=s.value.findIndex(l=>l.id===t.id);if(n!==-1){const l={...s.value[n],start:t.newStart,end:t.newEnd},o=[...s.value];o[n]=l,s.value=o,c("taskUpdated",l)}},X=e.computed(()=>a.value?T(a.value.start,a.value.end):0),H=e.computed(()=>{if(!a.value||!a.value.x||!a.value.y)return{};const t=u.left;return{position:"absolute",left:`${a.value.x+t}px`,top:`${a.value.y+u.top+5}px`,transform:"translateX(-50%)",zIndex:30,minWidth:"320px"}}),g=e.ref(null),x=e.ref(null),J=t=>{if(D.value||a.value||!g.value||!x.value)return;const n=g.value(new Date(t.start)),l=x.value(t.name);a.value={id:t.id,name:t.name,start:t.start,end:t.end,durationDays:T(t.start,t.end),x:n,y:l},e.nextTick(()=>{const o=document.querySelector(".gantt-edit-form input");o&&o.focus()})};e.watch(()=>{var t;return(t=a.value)==null?void 0:t.durationDays},(t,n)=>{a.value&&t&&t!==n&&(a.value.end=j(a.value.start,t))}),e.watch(()=>{var t;return(t=a.value)==null?void 0:t.start},(t,n)=>{a.value&&t&&t!==n&&(a.value.durationDays=T(t,a.value.end)),a.value&&t&&(a.value.end=j(t,a.value.durationDays))});const K=()=>{const{id:t,name:n,start:l,end:o}=a.value,h=new Date(l),r=new Date(o);if(h.getTime()>=r.getTime()){console.error("La date de début doit être strictement antérieure à la date de fin."),alert("Erreur: La date de début doit être antérieure à la date de fin.");return}M({id:t,newStart:l,newEnd:o}),a.value=null},Q=t=>{const n=new Date(f.startDate),l=new Date(f.endDate);g.value=d.scaleTime().domain([n,l]).range([0,t-u.left-u.right]),x.value=d.scaleBand().domain(Array.isArray(s.value)?s.value.map(o=>o.name):[]).range([0,s.value.length*40]).paddingInner(.1)},w=()=>{if(!V.value)return;C.value=V.value.clientWidth;const t=C.value;Q(t);const n=d.select(V.value);n.selectAll("*").remove();const o=n.append("svg").attr("width",t).attr("height",q.value).append("g").attr("transform",`translate(${u.left}, ${u.top})`);if(o.append("g").attr("transform",`translate(0, ${s.value.length*40||50})`).call(d.axisBottom(g.value)),o.append("g").call(d.axisLeft(x.value)),!s.value.length)return;const h=d.drag().on("start",function(r,m){D.value=!1,d.select(this).raise().classed("dragging",!0)}).on("drag",function(r,m){D.value=!0;const E=r.x;d.select(this).attr("x",E)}).on("end",function(r,m){if(d.select(this).classed("dragging",!1),D.value){const E=g.value.invert(r.x),S=new Date(m.end).getTime()-new Date(m.start).getTime(),_=new Date(E.getTime()+S),k=d.timeFormat("%Y-%m-%d")(E),v=d.timeFormat("%Y-%m-%d")(_);M({id:m.id,name:m.name,newStart:k,newEnd:v})}D.value=!1});s.value.forEach(r=>{const m=g.value(new Date(r.start)),S=g.value(new Date(r.end))-m,_=x.value(r.name),k=o.append("rect").datum(r).attr("x",m).attr("y",_).attr("width",S).attr("height",x.value.bandwidth()).attr("fill",r.color).attr("rx",4).style("cursor","grab").on("mouseenter",(v,R)=>{const[Z,ee]=d.pointer(v);p.value=R,N.value={x:Z+u.left,y:ee+u.top},d.select(v.currentTarget).style("filter","brightness(1.1)")}).on("mouseleave",v=>{p.value=null,d.select(v.currentTarget).style("filter","none")}).on("dblclick",function(v){J(r)});h(k)}),o.selectAll(".task-label").data(s.value).enter().append("text").text(r=>r.name).attr("x",r=>g.value(new Date(r.start))+5).attr("y",r=>x.value(r.name)+x.value.bandwidth()/2+5).attr("fill","black").style("pointer-events","none").style("font-size","12px")};return e.watch(()=>f.tasks,t=>{Array.isArray(t)?(s.value=t.map(n=>({...n})),w()):(s.value=[],w())},{immediate:!0,deep:!0}),e.onMounted(()=>{w(),window.addEventListener("resize",w)}),e.watch(()=>s.value,w,{deep:!0}),(t,n)=>(e.openBlock(),e.createElementBlock("div",F,[e.createElementVNode("div",{ref_key:"ganttContainer",ref:V,class:"relative w-full overflow-x-auto"},null,512),n[8]||(n[8]=e.createElementVNode("div",null,[e.createElementVNode("p",null,"Debug::"),e.createElementVNode("p",null,"taskUpdated")],-1)),p.value?(e.openBlock(),e.createElementBlock("div",{key:0,style:e.normalizeStyle(W.value),class:"bg-gray-800 text-white text-xs p-2 rounded-lg shadow-xl opacity-90 transition duration-150 z-40"},[e.createElementVNode("div",$,e.toDisplayString(p.value.name),1),e.createElementVNode("div",null,"Début: "+e.toDisplayString(p.value.start),1),e.createElementVNode("div",null,"Fin: "+e.toDisplayString(p.value.end),1),e.createElementVNode("div",A,"Durée: "+e.toDisplayString(T(p.value.start,p.value.end))+" jours",1)],4)):e.createCommentVNode("",!0),a.value?(e.openBlock(),e.createElementBlock("div",{key:1,style:e.normalizeStyle(H.value),class:"gantt-edit-form p-4 border border-blue-400 rounded-lg shadow-xl flex flex-col space-y-2 z-50"},[e.createElementVNode("div",I,"Éditer: "+e.toDisplayString(a.value.name),1),e.createElementVNode("label",L,[n[4]||(n[4]=e.createTextVNode(" Durée (jours): ",-1)),e.withDirectives(e.createElementVNode("input",{type:"number","onUpdate:modelValue":n[0]||(n[0]=l=>a.value.durationDays=l),min:"1",class:"mt-1 p-1 border rounded-md w-full text-sm focus:ring-blue-500 focus:border-blue-500"},null,512),[[e.vModelText,a.value.durationDays,void 0,{number:!0}]])]),n[7]||(n[7]=e.createElementVNode("hr",{class:"border-gray-200 my-1"},null,-1)),e.createElementVNode("label",O,[n[5]||(n[5]=e.createTextVNode(" Début: ",-1)),e.withDirectives(e.createElementVNode("input",{type:"date","onUpdate:modelValue":n[1]||(n[1]=l=>a.value.start=l),class:"mt-1 p-1 border rounded-md w-full text-sm focus:ring-blue-500 focus:border-blue-500"},null,512),[[e.vModelText,a.value.start]])]),e.createElementVNode("label",P,[n[6]||(n[6]=e.createTextVNode(" Fin: ",-1)),e.withDirectives(e.createElementVNode("input",{type:"date","onUpdate:modelValue":n[2]||(n[2]=l=>a.value.end=l),class:"mt-1 p-1 border rounded-md w-full text-sm focus:ring-blue-500 focus:border-blue-500"},null,512),[[e.vModelText,a.value.end]])]),e.createElementVNode("div",U,[e.createElementVNode("span",G," Durée effective: "+e.toDisplayString(X.value)+" j. ",1),e.createElementVNode("button",{onClick:K,class:"bg-blue-600 hover:bg-blue-700 text-white text-xs font-bold py-1 px-3 rounded-md transition duration-150"}," Valider ")]),e.createElementVNode("button",{onClick:n[3]||(n[3]=l=>a.value=null),class:"absolute top-1 right-1 text-gray-500 hover:text-gray-800 text-xs"}," × ")],4)):e.createCommentVNode("",!0)]))}},[["__scopeId","data-v-77b2fee1"]]);return{install(i){i.component("GanttChart",Y)}}});
