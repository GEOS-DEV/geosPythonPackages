(function(e,S){typeof exports=="object"&&typeof module<"u"?module.exports=S(require("vue"),require("d3")):typeof define=="function"&&define.amd?define(["vue","d3"],S):(e=typeof globalThis<"u"?globalThis:e||self,e.GanttLib=S(e.Vue,e.d3))})(this,function(e,S){"use strict";function q(m){const V=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(m){for(const c in m)if(c!=="default"){const w=Object.getOwnPropertyDescriptor(m,c);Object.defineProperty(V,c,w.get?w:{enumerable:!0,get:()=>m[c]})}}return V.default=m,Object.freeze(V)}const s=q(S),G=(m,V)=>{const c=m.__vccOpts||m;for(const[w,l]of V)c[w]=l;return c},W={class:"gantt-wrapper relative w-full"},X={class:"absolute top-0 right-0 z-10 flex space-x-4 items-center mr-2"},R={class:"flex items-center space-x-2"},H=["value"],J=["disabled"],K={key:0,class:"absolute inset-0 flex items-center justify-center bg-gray-50/50 z-20"},Q={class:"text-xl font-semibold text-gray-600 p-4 bg-white rounded-lg shadow-lg"},Z={key:1,class:"absolute inset-0 flex items-center justify-center bg-gray-50/50 z-20"},ee={class:"text-xs text-gray-500 mt-2"},te={class:"text-xs font-medium text-gray-600"},ae={class:"text-xs font-medium text-gray-600"},ne={class:"text-xs font-medium text-gray-600"},le={class:"text-xs font-medium text-gray-600"},re={class:"text-xs font-medium text-gray-600"},oe={class:"text-xs font-medium text-gray-600"},se={class:"mt-3 flex justify-between items-center"},ie={class:"text-xs font-bold text-blue-600"},de=G({__name:"GanttChart",props:{tasks:{type:Array,default:()=>[]},startDate:{type:String,default:"2012-12-12"},endDate:{type:String,default:"2013-12-13"}},emits:["taskUpdated","updateTasksOrder"],setup(m,{emit:V}){const c=V,w=m,l=e.ref([]),N=e.ref("All"),ue=e.computed(()=>{const a=new Set(["All"]);return l.value.forEach(t=>{t.category&&t.category.trim()&&a.add(t.category)}),Array.from(a).sort()}),M=e.ref(null),$=e.ref(0),k={top:40,right:20,bottom:30,left:50},C=e.ref(!1),r=e.ref(null),B=(a,t)=>{if(!a||!t)return 0;const n=new Date(a),o=new Date(t);if(n.getTime()>o.getTime())return 0;const d=Math.abs(o.getTime()-n.getTime());return Math.ceil(d/(1e3*60*60*24))+1},Y=(a,t)=>{if(!a||t<=0)return a;const n=new Date(a);return n.setDate(n.getDate()+t-1),s.timeFormat("%Y-%m-%d")(n)},z=a=>a.toISOString().split("T")[0],f=e.computed(()=>N.value==="All"?l.value:l.value.filter(a=>a.category===N.value)),ce=e.computed(()=>Math.max(150,f.value.length*40+k.top+k.bottom)),_=e.computed(()=>{if(l.value.length===0)return new Date(w.startDate);const a=l.value.map(t=>new Date(t.start));return new Date(Math.min(...a))}),O=e.computed(()=>{if(l.value.length===0)return new Date(w.endDate);const a=l.value.map(n=>new Date(n.end)),t=new Date(Math.max(...a));return t.setDate(t.getDate()+10),t}),me=()=>{const t=(l.value.length>0?Math.max(...l.value.map(o=>o.id)):0)+1;let n;if(l.value.length>0){const o=l.value[l.value.length-1],d=new Date(o.end).getTime()-new Date(o.start).getTime(),x=new Date(o.end);x.setDate(x.getDate()+1);const I=new Date(x.getTime()+d);n={id:t,name:`T√¢che Copi√©e ${t}`,start:z(x),end:z(I),color:o.color||"#4F46E5",category:o.category||"Uncategorized",isNew:!0}}else{const o=new Date,d=new Date;d.setDate(d.getDate()+10),n={id:t,name:`Premi√®re T√¢che ${t}`,start:z(o),end:z(d),color:"#4F46E5",category:"Planning",isNew:!0}}l.value.push(n),c("updateTasksOrder",l.value)},fe=()=>{if(l.value.length===0)return;const a=Math.max(...l.value.map(n=>n.id)),t=l.value.filter(n=>n.id!==a);l.value=t,c("updateTasksOrder",l.value)},ge=a=>{const t=l.value.findIndex(n=>n.id===a.id);if(t!==-1){const n={...l.value[t],start:a.newStart,end:a.newEnd,category:l.value[t].category,name:a.name||l.value[t].name},o=[...l.value];o[t]=n,l.value=o,c("taskUpdated",l.value)}},pe=e.computed(()=>r.value?B(r.value.start,r.value.end):0),xe=e.computed(()=>!r.value||!r.value.y||!M.value?{}:{position:"absolute",left:`${M.value.clientWidth/2}px`,top:`${r.value.y+k.top+5}px`,transform:"translateX(-50%)",zIndex:30,minWidth:"320px"}),v=e.ref(null),p=e.ref(null),ye=a=>{if(C.value=!1,r.value&&r.value.id===a.id){r.value=null;return}if(!v.value||!p.value)return;const t=v.value(new Date(a.start)),n=p.value(a.name);n!==void 0&&(r.value={id:a.id,name:a.name,start:a.start,end:a.end,durationDays:B(a.start,a.end),x:t,y:n,category:a.category||"Uncategorized",color:a.color},e.nextTick(()=>{const o=document.querySelector(".gantt-edit-form input");o&&o.focus()}))};e.watch(()=>{var a;return(a=r.value)==null?void 0:a.durationDays},(a,t)=>{r.value&&a&&a!==t&&(r.value.end=Y(r.value.start,a))}),e.watch(()=>{var a;return(a=r.value)==null?void 0:a.start},(a,t)=>{r.value&&a&&a!==t&&(r.value.durationDays=B(a,r.value.end)),r.value&&a&&(r.value.end=Y(a,r.value.durationDays))});const ve=()=>{const{id:a,name:t,start:n,end:o,category:d,color:x}=r.value,I=new Date(n),F=new Date(o);if(I.getTime()>=F.getTime()){console.error("La date de d√©but doit √™tre strictement ant√©rieure √† la date de fin."),console.warn("Erreur: La date de d√©but doit √™tre ant√©rieure √† la date de fin. Op√©ration annul√©e.");return}const j=l.value.findIndex(E=>E.id===a);if(j!==-1){const E={...l.value[j],name:t,start:n,end:o,category:d,color:x},A=[...l.value];A[j]=E,l.value=A,c("taskUpdated",l.value)}r.value=null},be=a=>{const t=_.value,n=O.value;v.value=s.scaleTime().domain([t,n]).range([0,a-k.left-k.right]),p.value=s.scaleBand().domain(Array.isArray(f.value)?f.value.map(o=>o.name):[]).range([0,f.value.length*40]).paddingInner(.1)},D=()=>{if(!M.value)return;$.value=M.value.clientWidth;const a=$.value;be(a);const t=s.select(M.value);t.selectAll("*").remove();const o=t.append("svg").attr("width",a).attr("height",ce.value).append("g").attr("transform",`translate(${k.left}, ${k.top})`);if(o.append("g").attr("transform",`translate(0, ${f.value.length*40||50})`).call(s.axisBottom(v.value)),o.append("g").attr("class","y-axis-g").call(s.axisLeft(p.value)),!f.value.length)return;let d=!1,x,I,F=-1;const j=p.value.step(),E=N.value!=="All",A=s.drag().on("start",function(i,u){if(r.value){s.select(this).style("cursor","pointer"),i.sourceEvent.stopPropagation();return}C.value=!1,d=!1,x=i.x,I=i.y,F=f.value.findIndex(b=>b.id===u.id),s.select(this).raise().classed("dragging",!0).style("cursor","grabbing")}).on("drag",function(i,u){if(r.value)return;const b=i.x-x,h=i.y-I;if(Math.abs(h)>5&&!E)d=!0,s.select(this).attr("transform",`translate(0, ${h})`);else if(Math.abs(b)>5||E){C.value=!0,d=!1;const g=v.value(new Date(u.start))+b;s.select(this).select("rect").attr("x",g),s.select(this).select("text").attr("x",g+5),s.select(this).attr("transform",null)}}).on("end",function(i,u){if(s.select(this).style("cursor","grab"),r.value){s.select(this).classed("dragging",!1).attr("transform",null);return}if(s.select(this).classed("dragging",!1).attr("transform",null),d&&!E){const b=p.value(u.name)+(i.y-I),h=Math.round(b/j),g=Math.max(0,Math.min(f.value.length-1,h));if(g!==F){const T=f.value[F].id,y=l.value.findIndex(P=>P.id===T),U=f.value[g].id,he=l.value.findIndex(P=>P.id===U),L=[...l.value],[we]=L.splice(y,1);L.splice(he,0,we),l.value=L,c("updateTasksOrder",l.value)}else D()}else if(C.value){const b=v.value(new Date(u.start))+(i.x-x),h=v.value.invert(b),g=new Date(u.end).getTime()-new Date(u.start).getTime(),T=new Date(h.getTime()+g),y=s.timeFormat("%Y-%m-%d")(h),U=s.timeFormat("%Y-%m-%d")(T);ge({id:u.id,name:u.name,newStart:y,newEnd:U})}else D();C.value=!1,d=!1});f.value.forEach(i=>{const u=v.value(new Date(i.start)),h=v.value(new Date(i.end))-u,g=p.value(i.name),T=o.append("g").datum(i).attr("class","task-group").on("contextmenu",function(y){y.preventDefault(),y.sourceEvent?y.sourceEvent.stopPropagation():y.stopPropagation(),ye(i)});T.append("rect").attr("x",u).attr("y",g).attr("width",h).attr("height",p.value.bandwidth()).attr("fill",i.color).attr("rx",4).style("cursor","grab"),A(T),T.append("text").text(y=>y.name).attr("x",u+5).attr("y",g+p.value.bandwidth()/2+5).attr("fill","black").style("pointer-events","none").style("font-size","12px"),E&&T.append("text").text("üö´").attr("x",-45).attr("y",g+p.value.bandwidth()/2+5).attr("fill","gray").style("font-size","14px").style("cursor","help").attr("title","R√©organisation d√©sactiv√©e en mode filtr√©")})};return e.watch(()=>w.tasks,a=>{if(Array.isArray(a)){const t=l.value.map(o=>o.id).join(","),n=a.map(o=>o.id).join(",");t!==n||a.length!==l.value.length?(l.value=a.map(o=>({...o})),D()):(l.value=a.map(o=>({...o})),D())}else l.value=[],D()},{immediate:!0,deep:!0}),e.onMounted(()=>{D(),window.addEventListener("resize",D)}),e.watch([()=>l.value,_,O,N],D,{deep:!0}),(a,t)=>(e.openBlock(),e.createElementBlock("div",W,[e.createElementVNode("div",X,[e.createElementVNode("div",R,[t[8]||(t[8]=e.createElementVNode("label",{for:"categoryFilter",class:"text-sm font-medium text-gray-700"},"Filtrer par:",-1)),e.withDirectives(e.createElementVNode("select",{id:"categoryFilter","onUpdate:modelValue":t[0]||(t[0]=n=>N.value=n),class:"p-1 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-sm"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(ue.value,n=>(e.openBlock(),e.createElementBlock("option",{key:n,value:n},e.toDisplayString(n),9,H))),128))],512),[[e.vModelSelect,N.value]])]),e.createElementVNode("button",{onClick:me,class:"bg-green-500 hover:bg-green-600 text-gray-500 font-bold py-1 px-2 rounded-full shadow-lg transition duration-150 text-lg leading-none w-8 h-8 flex items-center justify-center",title:"Ajouter une nouvelle t√¢che (copie de la derni√®re)"}," + "),e.createElementVNode("button",{onClick:fe,disabled:l.value.length===0,class:"bg-red-500 hover:bg-red-600 disabled:bg-gray-400 text-gray-500 font-bold py-1 px-2 rounded-full shadow-lg transition duration-150 text-lg leading-none w-8 h-8 flex items-center justify-center",title:"Supprimer la derni√®re t√¢che (ID max)"}," ‚àí ",8,J)]),e.createElementVNode("div",{ref_key:"ganttContainer",ref:M,class:"relative w-full overflow-x-auto"},[f.value.length===0&&l.value.length>0?(e.openBlock(),e.createElementBlock("div",K,[e.createElementVNode("p",Q," Aucune t√¢che ne correspond au filtre '"+e.toDisplayString(N.value)+"'. ",1)])):l.value.length===0?(e.openBlock(),e.createElementBlock("div",Z,[...t[9]||(t[9]=[e.createElementVNode("p",{class:"text-xl font-semibold text-gray-600 p-4 bg-white rounded-lg shadow-lg"}," Le tableau de t√¢ches est vide. Utilisez '+' pour commencer ! ",-1)])])):e.createCommentVNode("",!0)],512),e.createElementVNode("div",null,[e.createElementVNode("p",ee," Dates du graphique calcul√©es : "+e.toDisplayString(s.timeFormat("%Y-%m-%d")(_.value))+" √† "+e.toDisplayString(s.timeFormat("%Y-%m-%d")(O.value)),1),t[10]||(t[10]=e.createElementVNode("p",{class:"text-xs text-blue-500 font-medium"}," (CONSEIL: **Cliquez-droit** sur une barre de t√¢che pour l'√©diter. **Glissez verticalement** pour r√©ordonner (d√©sactiv√© si un filtre est appliqu√©).) ",-1))]),r.value?(e.openBlock(),e.createElementBlock("div",{key:0,style:e.normalizeStyle(xe.value),class:"gantt-edit-form p-4 border border-blue-400 rounded-lg shadow-xl flex flex-col space-y-2 z-50"},[t[17]||(t[17]=e.createElementVNode("div",{class:"text-sm font-semibold text-gray-700 mb-2"},"√âditer",-1)),e.createElementVNode("label",te,[t[11]||(t[11]=e.createTextVNode(" Nom: ",-1)),e.withDirectives(e.createElementVNode("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=n=>r.value.name=n),class:"mt-1 p-1 border rounded-md w-full text-sm focus:ring-blue-500 focus:border-blue-500"},null,512),[[e.vModelText,r.value.name]])]),e.createElementVNode("label",ae,[t[12]||(t[12]=e.createTextVNode(" Cat√©gorie: ",-1)),e.withDirectives(e.createElementVNode("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=n=>r.value.category=n),class:"mt-1 p-1 border rounded-md w-full text-sm focus:ring-blue-500 focus:border-blue-500"},null,512),[[e.vModelText,r.value.category]])]),e.createElementVNode("label",ne,[t[13]||(t[13]=e.createTextVNode(" Couleur: ",-1)),e.withDirectives(e.createElementVNode("input",{type:"color","onUpdate:modelValue":t[3]||(t[3]=n=>r.value.color=n),class:"mt-1 h-8 border rounded-md w-full focus:ring-blue-500 focus:border-blue-500"},null,512),[[e.vModelText,r.value.color]])]),t[18]||(t[18]=e.createElementVNode("hr",{class:"border-gray-200 my-1"},null,-1)),e.createElementVNode("label",le,[t[14]||(t[14]=e.createTextVNode(" Dur√©e (jours): ",-1)),e.withDirectives(e.createElementVNode("input",{type:"number","onUpdate:modelValue":t[4]||(t[4]=n=>r.value.durationDays=n),min:"1",class:"mt-1 p-1 border rounded-md w-full text-sm focus:ring-blue-500 focus:border-blue-500"},null,512),[[e.vModelText,r.value.durationDays,void 0,{number:!0}]])]),e.createElementVNode("label",re,[t[15]||(t[15]=e.createTextVNode(" D√©but: ",-1)),e.withDirectives(e.createElementVNode("input",{type:"date","onUpdate:modelValue":t[5]||(t[5]=n=>r.value.start=n),class:"mt-1 p-1 border rounded-md w-full text-sm focus:ring-blue-500 focus:border-blue-500"},null,512),[[e.vModelText,r.value.start]])]),e.createElementVNode("label",oe,[t[16]||(t[16]=e.createTextVNode(" Fin: ",-1)),e.withDirectives(e.createElementVNode("input",{type:"date","onUpdate:modelValue":t[6]||(t[6]=n=>r.value.end=n),class:"mt-1 p-1 border rounded-md w-full text-sm focus:ring-blue-500 focus:border-blue-500"},null,512),[[e.vModelText,r.value.end]])]),e.createElementVNode("div",se,[e.createElementVNode("span",ie," Dur√©e effective: "+e.toDisplayString(pe.value)+" j. ",1)]),e.createElementVNode("button",{onClick:ve,class:"bg-blue-600 hover:bg-blue-700 text-gray-500 text-xs font-bold py-1 px-3 rounded-md transition duration-150"}," Valider "),e.createElementVNode("button",{onClick:t[7]||(t[7]=n=>r.value=null),class:"absolute top-1 right-1 text-gray-500 hover:text-gray-800 text-xs"}," √ó ")],4)):e.createCommentVNode("",!0)]))}},[["__scopeId","data-v-76a01c2a"]]);return{install(m){m.component("GanttChart",de)}}});
